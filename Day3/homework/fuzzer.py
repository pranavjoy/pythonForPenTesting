import requests
import argparse
import threading
import sys
import subprocess

global content

content = []
parser = argparse.ArgumentParser()

parser.add_argument('-u', '--url',
                    help="use -u/--url for url input, and the word fuzz will be replaced", required=True)
parser.add_argument('-i', '--input',
                    help="use -i/--input to input the name of the fuzz file", required=True)
parser.add_argument('-m', '--multi',
                    help="fuzz faster, ain't nobody got time for this", action='store_true')
args = parser.parse_args()

url = args.url
threadCount = 4
input_file = args.input
directory = subprocess.check_output(['pwd', '-L']).decode("utf-8").replace("\n", "")
fuzz_dict = directory + "/" + input_file
lock = threading.Lock()


def test_existence(fuzz_element):
    r = requests.get(url.replace("fuzz", fuzz_element))
    if r.status_code == 200:
        print(url.replace("fuzz", fuzz_element) + " is a real boy")


def reader(list_input):
    while len(content) != 0:
        lock.acquire()
        a = list_input.pop()
        test_existence(a)
        lock.release()


with open(fuzz_dict) as f:
    content = f.readlines()

objectCount = len(content)
content = [x.strip() for x in content]
objectCount = len(content)

if args.multi:
    for x in range(threadCount):
        name = "Thread_" + str(x)
        t = threading.Thread(name=name, target=reader(content))
        t.start()
else:
    test_existence(content)
